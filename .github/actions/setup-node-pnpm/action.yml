name: 'Setup Node.js and PNPM'
description: 'Sets up Node.js with specified version and installs PNPM'
inputs:
  node-version:
    description: 'Node.js version to use'
    required: false
    default: '22.x'
  pnpm-version:
    description: 'PNPM version to use'
    required: false
    default: 'latest'
  cache:
    description: 'Enable dependency caching'
    required: false
    default: 'true'
  node-auth-token:
    description: 'Node.js authentication token for private registries (optional)'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: Install PNPM
      uses: pnpm/action-setup@v4
      with:
        version: ${{ inputs.pnpm-version }}

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node-version }}
        cache: ${{ inputs.cache == 'true' && 'pnpm' || '' }}

    - name: Configure npm auth for GitHub Packages
      shell: bash
      run: |
        printf "@pursuit-amsterdam:registry=https://npm.pkg.github.com\nalways-auth=true\n" > ~/.npmrc
        printf "//npm.pkg.github.com/:_authToken=${NODE_AUTH_TOKEN}\n" >> ~/.npmrc
      env:
        NODE_AUTH_TOKEN: ${{ inputs.node-auth-token }}

    - name: Install dependencies
      shell: bash
      run: pnpm install --frozen-lockfile